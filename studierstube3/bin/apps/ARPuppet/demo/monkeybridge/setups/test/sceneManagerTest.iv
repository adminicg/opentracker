#Inventor V2.1 ascii

DEF PUPPETEERTEST1 SoApplicationKit {

    info Info {}

    appGeom Separator {
    }

    contextKit SoContextKit {

        clonePipSheet  FALSE

        templatePipSheet Separator {}

        windowGroup Group {

            SoClassLoader {
                className "SoChoreographerKit"
                fileName "../apps/arpuppet/characters/arpuppet"
            }
            SoClassLoader {
                className "SoCal3DPuppeteer"
                fileName "../apps/arpuppet/characters/cal3dpuppet/cal3dpuppet"
            }
            SoClassLoader {
                className "SceneManager"
                fileName "../apps/arpuppet/demo/monkeybridge/monkeybridge"
            }
            SoClassLoader {
                className "GameManager"
                fileName "../apps/arpuppet/demo/monkeybridge/monkeybridge"
            }
            SoClassLoader {
                className "Choreographer"
                fileName "../apps/arpuppet/demo/monkeybridge/monkeybridge"
            }
            SoClassLoader {
                className "Character"
                fileName "../apps/arpuppet/demo/monkeybridge/monkeybridge"
            }
            SoClassLoader {
                className "MiniView"
                fileName "../apps/arpuppet/demo/monkeybridge/monkeybridge"
            }

            SoWindowKit {
                state MAXIMIZED
                clientVolume Separator {
                    
#################### GAME-SPECIFIC SETTINGS ---> go through the configuration steps below ######################################################################################
                    
                    # 1.) Set character ID to make turn on character-specific settings in the game. "-1" means that no character-specific settings will be used.
                    #     In case of a desktop based setup you HAVE to set the value to a valid user ID 0 <= <= (number of users - 1).
                    DEF CHARACTERNUM SoInfo { string "-1" }
                    
                    # 2.) Set partner machine's IP address if you are using the desktop-based setup
                    DEF PARTNER_IPADDRESS SoInfo { string "localhost" }
                    
                    # 3.) Go to the SCENEMANAGER node below in the scenegraph and set its useRemoteInfo field to one the following values depending on the game setup used:
                    #     a) no distribution: FALSE
                    #     b) distribution: if CHARACTERNUM.string = i, set useRemoteInfo[i] to FALSE and all the other values to TRUE
                    #                      e.g. in a dual-user setup for user 0 set [ FALSE, TRUE ]
                    #     c) observer mode with distribution: set TRUE for all users, e.g. in a dual-user setup [ TRUE, TRUE ]
                    #
                    # 4.) If you  use distribution, uncomment the client SoSocketModules connected to SCENEMANAGER.tileSnappedInfoRemote and SCENEMANAGER.tileToPlaceTypeRemote
                    #     and the server SoSocketModules below the SCENEMANAGER node
                    #
                    # 5.) If you  use distribution, uncomment the SOCKET_CLIENT_INIT or SOCKET_SERVER_INIT SoSocketModule depending on the instructions written in 
                    #     the GAMEMANAGER node below

#################### end of GAME-SPECIFIC SETTINGS #############################################################################################################################
                    
                    # keyboard commands
                    DEF KEY_S SoKeyToggle { key "s" } # start/stop game

                    Separator{
                        Separator {
                            DEF ORTHOGRAPHICCAMERA SoOrthographicCamera {
                                height 1.0
                                aspectRatio 1.0
                                nearDistance 0.5
                                viewportMapping LEAVE_ALONE
                            }
                            SoTransform { translation 0 0 0 scaleFactor 0.01 0.012 0.01 }
                            DEF GAMEMANAGER GameManager {
                                texture DEF TEXTTEXTURE SoTexture2 { 
                                    filename "../apps/arpuppet/demo/monkeybridge/texture/texttexture.jpg" 
                                    model DECAL
                                }
                                material DEF TEXTMATERIAL SoMaterial {
                                    diffuseColor 1 1 1
                                }
                                font DEF TEXTFONT SoFont {
                                    name "Arial : Bold"
                                    size 14
                                }
                                countdownFrom 5
                                speed 1.0
                                # comment out the following node if it's a desktop-based setup and you are NOT the user who starts the game, otherwise leave it uncommented
                                init = USE KEY_S.toggled
                                # uncomment the following node if it's a desktop-based setup and you are NOT the user who starts the game, otherwise leave it commented
                                #init = DEF SOCKET_CLIENT_INIT SoSocketModule {
                                #    port 55555
                                #    mode CLIENT
                                #    address = USE PARTNER_IPADDRESS.string
                                #    in = USE GAMEMANAGER.init
                                #}.out
                            }
                            # uncomment the following node if it's a desktop-based setup and you are the user who starts the game, otherwise leave it commented
                            #DEF SOCKET_SERVER_INIT SoSocketModule {
                            #    port 55555
                            #    mode SERVER
                            #    in = USE GAMEMANAGER.init
                            #}
                        }

                        DEF CHOREOGRAPHER Choreographer {
                            id "choreographer"
                            puppeteers Separator {
                                
                                DEF SCENEMANAGER SceneManager {
                                    id "scenemanager"
                                    tileSize 0.1
                                    maxCoordinate 10 10
                                    station 0
                                    controlMode [ STATION, STATION ]
                                    tileToPlacePosition = SoConcatenate {
                                        type SoMFVec3f
                                        input0 = DEF TRAK_USER0_TILE0 SoTrakEngine { station 1 }.translation
                                        input1 = DEF TRAK_USER1_TILE0 SoTrakEngine { station 2 }.translation
                                    }.output
                                    tileToPlaceOrientation = SoConcatenate {
                                        type SoMFRotation
                                        input0 = USE TRAK_USER0_TILE0.rotation
                                        input1 = USE TRAK_USER1_TILE0.rotation
                                    }.output
                                    # playfieldInitInfo element: x, y, userID+(tileNum+1)/10.0f, tileID+rotation%(PI/2)*0.25f
                                    # tileType: INVALID=-2, WATER=-1, STARTTILE, ENDTILE, FIXTILE0, FIXTILE1, DECORATION0, DECORATION1,
                                    #           USERTILE0, USERTILE1, USERTILE2, USERTILE3, USERTILE4, USERTILE5, USERTILE6, USERTILE7, USERTILE8
                                    playfieldInitInfo [ 
                                        9 9 0 0.25, # start tile player0
                                        0 0 1 0,    # start tile player1
                                        6 7 0 1,    # end tile player0
                                        5 1 1 1,    # end tile player1
                                        1 2 -2 2,   # fixed slope tile #1
                                        5 6 -2 3.5  # fixed slope tile #2
                                    ]
                                    # bonusObjectInfo [ ]
                                    init = USE GAMEMANAGER.init
                                    tileNum 1  # this field can be set individually for each user as well
                                    playerNum 2
                                    tileToPlaceNumMax 2 # this field can be set individually for each user as well
                                    timeOut 3 # this field can be set individually for each user as well
                                    enabled = USE GAMEMANAGER.enabled
                                    maxTileTypeID 14
                                    avoidTileType [ 0, 1, 2, 3, 4, 5 ]
                                    showPhysicalTiles TRUE
                                    physicalTileTexture "../apps/arpuppet/demo/monkeybridge/texture/stone.jpg"
                                    tileLibrary SoSwitch {
                                        whichChild -1
                                        # start and end tile
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/startTile.iv" }
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/endTile.iv" }
                                        # fix tiles
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/fixtile_12a.iv" }
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/fixtile_22.iv" }
                                        # decoration elements
                                        SoSphere { radius 0.05 }
                                        SoCube { width 0.05 height 0.05 depth 0.05 }
                                        # user tiles
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/tile_12a.iv" }
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/tile_12b.iv" }
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/tile_12c.iv" }
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/tile_13.iv" }
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/tile_22.iv" }
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/tile_23a.iv" }
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/tile_23b.iv" }
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/tile_23c.iv" }
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/tile_33.iv" }
                                    }                                    
                                    useRemoteInfo [ FALSE, FALSE ] ########################## set this manually!!! #############################
                                    #tileSnappedInfoRemote = DEF SOCKET_CLIENT_INFO SoSocketModule {
                                    #    mode CLIENT
                                    #    address = USE PARTNER_IPADDRESS.string
                                    #    port = SoSelectOne {
                                    #        type SoMFInt32
                                    #        input [ 55556, 55558 ]
                                    #        index = USE CHARACTERNUM.string
                                    #    }.output
                                    #}.out
                                    #tileToPlaceTypeRemote = DEF SOCKET_CLIENT_TYPE SoSocketModule {
                                    #    mode CLIENT
                                    #    address = USE PARTNER_IPADDRESS.string
                                    #    port = SoSelectOne {
                                    #        type SoMFInt32
                                    #        input [ 55557, 55559 ]
                                    #        index = USE CHARACTERNUM.string
                                    #    }.output
                                    #}.out
                                    
                                } # end of sceneManager

                            } # end of puppeteers
                        } # end of Choreographer
                        
                        #DEF SOCKET_SERVER_INFO SoSocketModule {
                        #    port = SoSelectOne {
                        #        type SoMFInt32
                        #        input [ 55558, 55556 ]
                        #        index = USE CHARACTERNUM.string
                        #    }.output
                        #    mode SERVER
                        #    in = USE SCENEMANAGER.tileSnappedInfo
                        #}
                        #DEF SOCKET_SERVER_TYPE SoSocketModule {
                        #    port = SoSelectOne {
                        #        type SoMFInt32
                        #        input [ 55559, 55557 ]
                        #        index = USE CHARACTERNUM.string
                        #    }.output
                        #    mode SERVER
                        #    in = USE SCENEMANAGER.tileToPlaceType
                        #}

                        # occupancy info
                        Separator {
                            USE ORTHOGRAPHICCAMERA
                            SoTransform { translation -0.4 0.38 0 scaleFactor 1.0 1.2 1.0 }
                            DEF MV_OCCUPANCY MiniView {
                                maxCoordinate = USE SCENEMANAGER.maxCoordinate
                                tileSize 0.02
                                defaultTileColor 0.15 0.15 0.15
                                userTileColor [ 1 0 0, 0 0 1 ]
                                fixTileColor 0.7 0.7 0.7
                                positionColor [ 0 0 0, 1 1 1 ]
                                pathColor [ 0 0 1, 1 1 0 ]
                                occupationInfo = USE SCENEMANAGER.playfieldInfo
                                currentPosition = USE SCENEMANAGER.currentTileCoord
                                nextPosition = USE SCENEMANAGER.nextTileCoord
                            }
                        }
                        SoRoute { from "MV_OCCUPANCY.userTileColor" to "SCENEMANAGER.tileColor" }

                        # auxiliary grid for tile positioning
                        Separator {
                            Transform {
                                translation = DEF PLAYFIELDTRACKER SoTrakEngine { 
                                    station = USE SCENEMANAGER.station 
                                }.translation
                                rotation = USE PLAYFIELDTRACKER.rotation
                            }
                            Transform {
                                rotation 1 0 0 -1.57
                            }
                            SoDrawStyle {
                                style LINES
                            }
                            DEF MV_GRID MiniView {
                                occupationInfo -2 -2
                                maxCoordinate = USE SCENEMANAGER.maxCoordinate
                                defaultTileColor 0.5 0.5 0.5
                                tileSize 0.1
                            }
                        }
                        
                        # orientation information
                        Separator {
                            Transform {
                                translation = USE PLAYFIELDTRACKER.translation
                                rotation = USE PLAYFIELDTRACKER.rotation
                            }
                            Separator {
                                Transform {
                                   translation 0 0.03 -0.62
                                   scaleFactor 0.0005 0.0005 0.0005
                                }
                                SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/north.iv" }
                            }
                        }

                        # cursor for player#0, tile#0
                        Switch {
                            whichChild = SoSelectOne {
                                type SoMFBool
                                input = SoBoolOperation {
                                    a = USE SCENEMANAGER.useRemoteInfo
                                    operation NOT_A
                                }.output
                                index 0
                            }.output
                            Separator {}
                            Separator {
                                Transform {
                                    translation = USE TRAK_USER0_TILE0.translation
                                    rotation = USE TRAK_USER0_TILE0.rotation
                                }
                                SoBillboardKit {
                                    content SoSeparator {
                                        Transform { translation 0 0.16 0 scaleFactor 0.0003 0.0008 0.0003 rotation 1 0 0 1.57 }
                                        Switch {
                                            whichChild = SoCalculator {
                                                a = SoSelectOne {
                                                    type SoMFBool
                                                    input = USE SCENEMANAGER.tilePlacedCursorOn
                                                    index 0
                                                }.output
                                                b = SoSelectOne {
                                                    type SoMFBool
                                                    input = USE SCENEMANAGER.isOverValidCoord
                                                    index 0
                                                }.output
                                                expression "oa = (a==1) ? 2 : b"
                                            }.oa
                                            DEF CURSOR_WRONG Separator {
                                                SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/cross.iv" }
                                            }
                                            DEF CURSOR_TILEPLACING Separator {
                                                SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/downarrow.iv" }
                                            }
                                            DEF CURSOR_TILEPLACED Separator {
                                                SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/checkmark.iv" }
                                            }
                                        }
                                        Material { diffuseColor 1 1 0 }
                                        Transform { translation 0 0 -200 }
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/one.iv" }
                                    }
                                }
                            }
                        }

                        # cursor for player#1, tile#0
                        Switch {
                            whichChild = SoSelectOne {
                                type SoMFBool
                                input = SoBoolOperation {
                                    a = USE SCENEMANAGER.useRemoteInfo
                                    operation NOT_A
                                }.output
                                index 1
                            }.output
                            Separator {}
                            Separator {
                                Transform { 
                                    translation = USE TRAK_USER1_TILE0.translation
                                    rotation = USE TRAK_USER1_TILE0.rotation
                                }
                                SoBillboardKit {
                                    content SoSeparator {
                                        Transform { translation 0 0.16 0 scaleFactor 0.0003 0.0008 0.0003 rotation 1 0 0 1.57 }
                                        Switch {
                                            whichChild = SoCalculator {
                                                a = SoSelectOne {
                                                    type SoMFBool
                                                    input = USE SCENEMANAGER.tilePlacedCursorOn
                                                    index 1
                                                }.output
                                                b = SoSelectOne {
                                                    type SoMFBool
                                                    input = USE SCENEMANAGER.isOverValidCoord
                                                    index 1
                                                }.output
                                                expression "oa = (a==1) ? 2 : b"
                                            }.oa
                                            USE CURSOR_WRONG
                                            USE CURSOR_TILEPLACING
                                            USE CURSOR_TILEPLACED
                                        }
                                        Material { diffuseColor 1 1 0 }
                                        Transform { translation 0 0 -200 }
                                        SoFile { name "../apps/arpuppet/demo/monkeybridge/mesh/two.iv" }
                                    }
                                }
                            }
                        }
                            
                        # debugger
                        SoSeparator {
                            Transform { 
                                translation 0 0.3 0
                                scaleFactor 0.005 0.005 0.005
                            }
                            SoText3 {
                                parts ALL
                                string = SoConcatenate {
                                    type SoMFString
                                    input0 = USE SCENEMANAGER.tileSnappedInfoTemp
                                }.output
                            }
                        }
                    } # end of Separator

                } # end of clientVolume

            } # end of windowKit

        } # end of windowGroup

    } # end of contextKit

} # end of applicationKit
