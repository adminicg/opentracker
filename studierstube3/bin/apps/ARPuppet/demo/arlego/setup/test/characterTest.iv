#Inventor V2.1 ascii

DEF ARLEGO SoApplicationKit {

    info Info {}

    appGeom Separator {
    }

    contextKit SoContextKit {

        clonePipSheet  FALSE

        templatePipSheet Separator {
        } # end of templatePipSheet

        windowGroup Group {

            SoClassLoader {
                className   "SoChoreographerKit"
                fileName    "../apps/arpuppet/characters/arpuppet"
            }
            SoClassLoader {
                className   "SoCal3DPuppeteer"
                fileName    "../apps/arpuppet/characters/cal3dpuppet/cal3dpuppet"
            }
            SoClassLoader {
                className   "SoLegoPuppeteer"
                fileName    "../apps/arpuppet/characters/legopuppet/legopuppet"
            }
            SoClassLoader {
                className   "Character"
                fileName    "../apps/arpuppet/demo/arlego/arlego"
            }
            SoClassLoader {
                className   "Choreographer"
                fileName    "../apps/arpuppet/demo/arlego/arlego"
            }

            SoWindowKit {
                state MAXIMIZED
                clientVolume Separator {

                    DEF KEY_N SoKeyToggle { key "n" } # next command

                    Switch {
                        whichChild 1
                        Separator {}
                        DEF CONTENT Separator {
                            Separator {
                                Material { diffuseColor 0.1 0.1 0.1 }
                                DEF WHEEL_FRONT_RIGHT_A File { name "../apps/arpuppet/demo/arlego/mesh/robot_13a.iv" }
                            }
                            Separator {
                                Material { 
                                    diffuseColor 1 1 1 
                                    transparency 0
                                }
                                DEF WHEEL_FRONT_RIGHT_B File { name "../apps/arpuppet/demo/arlego/mesh/robot_13b.iv" }
                            }
                        }
                    }

                    DEF CHOREOGRAPHER SoChoreographerKit {
                        puppeteers SoSeparator {
                            DEF LEGOMAXL_PUPPETEER Character {
                                id "legomaxl"
                                controlMode [ (STATION | DRAG), (STATION | DRAG), EXTERNAL ] ############### to be controlled by Director!!!
                                station 2
                                scaleSet = SoInfo { string "0.8 0.8 0.8" }.string
                                hotspotBoneID [ 19, 13 ]
                                hotspotName [ "right_hand", "left_hand" ]
                                hotspotRot [ 0 1 0 1.57 ]
                                hsOffset [ 0 0 0.03 ]
                                puppets SoDragKit {
                                    content Separator {
                                        SoMultiSwitch {
                                            DEF LEGOMAXL_PUPPET SoCal3DPuppet {
                                                pathName "../apps/arpuppet/characters/cal3dpuppet/data"
                                                fileName "legomaxl.cfg"
                                                animate = SoKeyToggle { key "S" }.toggled
                                                
                                                delayIn 0.4
                                                delayOut 0.4
                                            } # end of SoCal3DPuppet
                                        }
                                    }
                                }
                                animationPrefix "legomaxl_"
                                animationMap "idle hold_2"
                            } # end of Cal3DPuppeteer
                            DEF NEXTTILE SoPuppeteerKit {
                                id "nexttile"
                                controlMode [ ( EXTERNAL ), ( EXTERNAL ) ]
                                showPuppeteer TRUE
                                #station = USE LEGOMAXL_PUPPETEER.station
                                positionOffset = SoCalculator {
                                    A = SoSelectOne {
                                        type SoMFVec3f
                                        input = USE LEGOMAXL_PUPPETEER.hotspotCoord
                                        index 0
                                    }.output
                                    B = SoSelectOne {
                                        type SoMFVec3f
                                        input = USE LEGOMAXL_PUPPETEER.hotspotCoord
                                        index 1
                                    }.output
                                    a 0 # 0 = single-handed mode, 1 = two-handed mode
                                    expression "oA = (a==0) ? A : (A+B)/2"
                                }.oA
                                orientationOffset = USE LEGOMAXL_PUPPETEER.hotspotRot
                                positionBase = USE LEGOMAXL_PUPPETEER.position
                                orientationBase = USE LEGOMAXL_PUPPETEER.orientation
                                boundingBoxMode OBB
                                boundingBoxOn TRUE
                                puppets SoDragKit {
                                    content Separator {
                                        SoMultiSwitch {
                                            Separator {
                                                DEF TRANS Transform { 
                                                    translation = SoCalculator {
                                                        A = DEF BBCALC SoComputeBoundingBox {
                                                            node USE CONTENT
                                                        }.boxCenter
                                                        expression"oA = -A"
                                                    }.oA
                                                }
                                                USE CONTENT
                                            }
                                        }
                                    }
                                }                                
                            }
                        }
                    } # end of Choreographer

                    Separator {
                        Transform { translation 0 0.2 0 scaleFactor 0.005 0.005 0.005}
                        SoText3 { 
                            string = USE CHOREOGRAPHER.command #LEGOMAXL_PUPPETEER.hotspotCoord
                            justification CENTER 
                        }
                    }
                    
                    SoTrackedArtifactKit {
                        station 3
                        geometry Separator {
                            Material { diffuseColor 1 0 0 }
                            Sphere { radius 0.008 }
                        }
                    }

                } # end of clientVolume

            } # end of windowKit

        } # end of windowGroup

    } # end of contextKit

} # end of applicationKit
