#Inventor V2.1 ascii

DEF ARLEGO SoApplicationKit {

    info Info {}

    appGeom Separator {
    }

    contextKit SoContextKit {

        clonePipSheet  FALSE

        templatePipSheet Separator {
        } # end of templatePipSheet

        windowGroup Group {

            SoClassLoader {
                className   "SoChoreographerKit"
                fileName    "../apps/arpuppet/characters/arpuppet"
            }
            SoClassLoader {
                className   "SoCal3DPuppeteer"
                fileName    "../apps/arpuppet/characters/cal3dpuppet/cal3dpuppet"
            }
            SoClassLoader {
                className   "SoLegoPuppeteer"
                fileName    "../apps/arpuppet/characters/legopuppet/legopuppet"
            }
            SoClassLoader {
                className   "Character"
                fileName    "../apps/arpuppet/demo/arlego/arlego"
            }
            SoClassLoader {
                className   "Choreographer"
                fileName    "../apps/arpuppet/demo/arlego/arlego"
            }
            SoClassLoader {
                className   "Director"
                fileName    "../apps/arpuppet/demo/arlego/arlego"
            }
            SoClassLoader {
                className   "SoSpeechOutput" 
                fileName    "StbSpeech"
            }

            SoWindowKit {
                state MAXIMIZED
                clientVolume Separator {

                    DEF KEY_N SoKeyToggle { key "n" } # next construction step
                    DEF KEY_H SoKeyToggle { key "h" } # HUD on/off
                    DEF KEY_B SoKeyToggle { key "b" } # battery power visualization on/off
                    DEF KEY_S SoKeyToggle { key "s" } # text-to-speech on/off
                    DEF KEY_I SoKeyToggle { key "i" } # construction step index (current/total step No.) on/off
                    DEF KEY_O SoKeyToggle { key "o" } # change tracking structure visualization mode
                    DEF KEY_K SoKeyToggle { key "k" } # turn automatic construction step incrementation on/off
                    DEF KEY_P SoKeyToggle { key "p" } # use / don't use virtual presenter

                    DEF DIRECTOR Director {
                        constructionFile "../apps/arpuppet/demo/arlego/construction.txt"
                        constructionStep = DEF STEPCOUNTER SoTimeCounter { 
                            min 0
                            max = USE DIRECTOR.maxConstructionStepIndex
                            frequency = SoCalculator {
                                a = USE DIRECTOR.maxConstructionStepIndex
                                b 1
                                expression "oa = b/a"
                            }.oa
                            on = USE KEY_K.toggled
                        }.output
                        #DEF CONSTRUCTIONSTEP_VAR SoVariable {
                        #    type INT
                        #    a = USE DIRECTOR.maxConstructionStepIndex
                        #    oa -1
                        #    expression "oa=(oa+1)%(a+1)"
                        #    eval = USE KEY_N.toggled
                        #}.oa
                        # showAgainStep
                        displayMode SHOW_UP_TO_CURRENT # SHOW_CURRENT_ONLY
                        permanentPuppetNum 2
                        permanentAttributeNum 1
                        usePresenter = USE KEY_P.toggled
                    }

                    DEF CHOREOGRAPHER Choreographer {
                        puppeteers SoSeparator {
                            DEF LEGOPUPPETEER SoLegoPuppeteer {
                                command "" = DEF SELECT SoSelectOne {
                                    type SoMFString
                                    input [
                                        "",
                                        "motorState `-*-`",
                                        "sensorState `---`",
                                        "motorDir `f*b`",
                                        "motorState `+*+`",
                                        "setSensor `ttl`",
                                        "sensorState `+--`",
                                        "sensorState `--+`",
                                    ]
                                    index = SoCalculator {
                                        a = USE DIRECTOR.constructionStep
                                        expression [
                                            "ta = (a==0) ? 1 : 0",
                                            "ta = (a==1) ? 2 : 0",
                                            "ta = (a==26) ? 3 : ta",
                                            "ta = (a==27) ? 4 : ta",
                                            "ta = (a==28) ? 5 : ta",
                                            "ta = (a==29) ? 6 : ta",
                                            "oa = (a==31) ? 7 : ta"
                                        ]
                                    }.oa
                                }.output
                                synchRCX TRUE
                                controlMode [ STATION, STATION, EXTERNAL ]
                                scaleSet = SoInfo { string "0.48 0.48 0.48" }.string
                                station 0
                                whichPuppets = USE DIRECTOR.showModelPart
                                whichAttributes = USE DIRECTOR.showAugmentation
                                puppets SoDragKit {
                                    content Separator {
                                        SoMultiSwitch {
                                            # permanent puppets, the number of them should be set in DIRECTOR.permanentPuppetNum
                                            # physical LEGO robot control
                                            DEF LEGOPUPPET SoLegoPuppet {}
                                            Switch {
                                                whichChild = SoVariable {
                                                    type INT
                                                    oa -1
                                                    expression [ "oa=(oa+1)%3" ]
                                                    eval = USE KEY_O.toggled
                                                }.oa
                                                Separator {}
                                                Separator {
                                                    Separator {
                                                        Material { diffuseColor 0.5 0.5 0.5 transparency 0 }
                                                        DEF ART_MARKER_HOLDER File { name "../apps/arpuppet/demo/arlego/mesh/robot_art_marker_holder.iv" }
                                                    }
                                                    Separator {
                                                        Material { diffuseColor 1 1 1 transparency 0 }
                                                        DEF ART_MARKER File { name "../apps/arpuppet/demo/arlego/mesh/art_marker.iv" }
                                                    }
                                                }
                                                Separator {
                                                    Separator {
                                                        Material { diffuseColor 0.5 0.5 0.5 transparency 0 }
                                                        DEF ARTOOLKIT_MARKER_HOLDER File { name "../apps/arpuppet/demo/arlego/mesh/robot_artoolkit_marker_holder.iv" }
                                                    }
                                                    Separator {
                                                        Material { diffuseColor 1 1 1 transparency 0 }
                                                        DEF ARTOOLKIT_MARKER File { name "../apps/arpuppet/demo/arlego/mesh/artoolkit_marker.iv" }
                                                    }
                                                }
                                            }

                                            # virtual LEGO model elements, we start indexing the model parts being referred to in the construction file here from zero
                                            Separator {
                                                DEF YELLOW Material { diffuseColor 1 1 0 }
                                                DEF RCX File { name "../apps/arpuppet/demo/arlego/mesh/robot_00.iv" }
                                            }
                                            Separator {
                                                Separator {
                                                    DEF BLACK Material { diffuseColor 0.08 0.08 0.08 }
                                                    Separator { DEF ENGINEMOUNT_BOTTOM_1A File { name "../apps/arpuppet/demo/arlego/mesh/robot_01a.iv" } }
                                                    Separator { DEF ENGINEMOUNT_BOTTOM_1B File { name "../apps/arpuppet/demo/arlego/mesh/robot_01b.iv" } }
                                                }
                                                Separator {
                                                    DEF GRAY Material { diffuseColor 0.5 0.5 0.5 }
                                                    Separator { DEF ENGINEMOUNT_BOTTOM_1C File { name "../apps/arpuppet/demo/arlego/mesh/robot_01c.iv" } }
                                                    Separator { DEF ENGINEMOUNT_BOTTOM_1D File { name "../apps/arpuppet/demo/arlego/mesh/robot_01d.iv" } }
                                                }
                                            }
                                            Separator {
                                                USE GRAY
                                                DEF ENGINE_C File { name "../apps/arpuppet/demo/arlego/mesh/robot_02.iv" }
                                            }
                                            Separator {
                                                USE GRAY
                                                DEF ENGINE_A File { name "../apps/arpuppet/demo/arlego/mesh/robot_03.iv" }
                                            }
                                            Separator {
                                                Separator {
                                                    USE BLACK
                                                    DEF FRAME_RIGHT_A File { name "../apps/arpuppet/demo/arlego/mesh/robot_04a.iv" }
                                                }
                                                Separator {
                                                    USE GRAY
                                                    DEF FRAME_RIGHT_B File { name "../apps/arpuppet/demo/arlego/mesh/robot_04b.iv" }
                                                }
                                            }
                                            Separator {
                                                Separator {
                                                    USE BLACK
                                                    DEF FRAME_LEFT_A File { name "../apps/arpuppet/demo/arlego/mesh/robot_05a.iv" }
                                                }
                                                Separator {
                                                    USE GRAY
                                                    DEF FRAME_LEFT_B File { name "../apps/arpuppet/demo/arlego/mesh/robot_05b.iv" }
                                                }
                                            }
                                            Separator {
                                                Separator {
                                                    USE BLACK
                                                    DEF FRAME_FRONT_A File { name "../apps/arpuppet/demo/arlego/mesh/robot_06a.iv" }
                                                }
                                                Separator {
                                                    USE GRAY
                                                    DEF FRAME_FRONT_B File { name "../apps/arpuppet/demo/arlego/mesh/robot_06b.iv" }
                                                }
                                                Separator {
                                                    USE BLACK
                                                    DEF FRAME_FRONT_C File { name "../apps/arpuppet/demo/arlego/mesh/robot_06c.iv" }
                                                }
                                            }
                                            Separator {
                                                USE GRAY
                                                DEF FRAME_BOTTOM_RIGHT File { name "../apps/arpuppet/demo/arlego/mesh/robot_07.iv" }
                                            }
                                            Separator {
                                                USE GRAY
                                                DEF FRAME_BOTTOM_LEFT File { name "../apps/arpuppet/demo/arlego/mesh/robot_08.iv" }
                                            }
                                            Separator {
                                                USE GRAY
                                                DEF FRAME_WHEEL_MOUNT_RIGHT File { name "../apps/arpuppet/demo/arlego/mesh/robot_09.iv" }
                                            }
                                            Separator {
                                                USE GRAY
                                                DEF FRAME_WHEEL_MOUNT_LEFT File { name "../apps/arpuppet/demo/arlego/mesh/robot_10.iv" }
                                            }
                                            Separator {
                                                USE YELLOW
                                                DEF FRAME_STIFFENER_A File { name "../apps/arpuppet/demo/arlego/mesh/robot_11.iv" }
                                            }
                                            Separator {
                                                USE YELLOW
                                                DEF FRAME_STIFFENER_B File { name "../apps/arpuppet/demo/arlego/mesh/robot_12.iv" }
                                            }
                                            Separator {
                                                Separator {
                                                    USE BLACK
                                                    DEF WHEEL_FRONT_RIGHT_A File { name "../apps/arpuppet/demo/arlego/mesh/robot_13a.iv" }
                                                }
                                                Separator {
                                                    DEF WHITE Material { 
                                                        diffuseColor 1 1 1 
                                                        transparency 0
                                                    }
                                                    DEF WHEEL_FRONT_RIGHT_B File { name "../apps/arpuppet/demo/arlego/mesh/robot_13b.iv" }
                                                }
                                            }
                                            Separator {
                                                Separator {
                                                    USE BLACK
                                                    DEF WHEEL_FRONT_LEFT_A File { name "../apps/arpuppet/demo/arlego/mesh/robot_14a.iv" }
                                                }
                                                Separator {
                                                    USE WHITE
                                                    DEF WHEEL_FRONT_LEFT_B File { name "../apps/arpuppet/demo/arlego/mesh/robot_14b.iv" }
                                                }
                                            }
                                            Separator {
                                                Separator {
                                                    USE BLACK
                                                    DEF WHEEL_BACK_RIGHT_A File { name "../apps/arpuppet/demo/arlego/mesh/robot_15a.iv" }
                                                }
                                                Separator {
                                                    USE WHITE
                                                    DEF WHEEL_BACK_RIGHT_B File { name "../apps/arpuppet/demo/arlego/mesh/robot_15b.iv" }
                                                }
                                            }
                                            Separator {
                                                Separator {
                                                    USE BLACK
                                                    DEF WHEEL_BACK_LEFT_A File { name "../apps/arpuppet/demo/arlego/mesh/robot_16a.iv" }
                                                }
                                                Separator {
                                                    USE WHITE
                                                    DEF WHEEL_BACK_LEFT_B File { name "../apps/arpuppet/demo/arlego/mesh/robot_16b.iv" }
                                                }
                                            }
                                            Separator {
                                                USE BLACK
                                                DEF ENGINE_C_CONNECTORS File { name "../apps/arpuppet/demo/arlego/mesh/robot_17.iv" }
                                            }
                                            Separator {
                                                USE BLACK
                                                DEF ENGINE_A_CONNECTORS File { name "../apps/arpuppet/demo/arlego/mesh/robot_18.iv" }
                                            }
                                            Separator {
                                                DEF PUSH_SENSOR File { name "../apps/arpuppet/demo/arlego/mesh/robot_19.iv" }
                                            }
                                            Separator {
                                                DEF LIGHT_SENSOR File { name "../apps/arpuppet/demo/arlego/mesh/robot_20.iv" }
                                            }
                                        }
                                    }
                                } # end of puppets
                                attributes SoMultiSwitch {
                                    # permanent attributes, the number of them should be set in DIRECTOR.permanentPuppetNum
                                    Separator {
                                        SoSwitch {
                                            whichChild = SoBoolOperation {
                                                a = USE LEGOPUPPETEER.alive
                                                b = USE KEY_B.toggled
                                                operation A_AND_NOT_B
                                            }.output
                                            Separator {}
                                            Separator {
                                                # battery power stripe
                                                Separator {
                                                    Transform {
                                                        translation 0 0 -0.19
                                                        scaleFactor 2 2 2
                                                    }
                                                    SoTransform { 
                                                        translation = SoComposeVec3f {
                                                            x = SoCalculator {
                                                                a = USE LEGOPUPPETEER.batteryPower
                                                                expression "oa = a / 9300 * 0.05 - 0.0575"
                                                            }.oa
                                                            y 0
                                                            z 0
                                                        }.vector
                                                    }
                                                    SoBaseColor { rgb 0.0 1.0 0.0 }
                                                    DEF BATTERY_POWER SoCube {
                                                        width = SoCalculator {
                                                            a = USE LEGOPUPPETEER.batteryPower
                                                            expression "oa = a / 9300 * 0.1"
                                                        }.oa
                                                        height 0.015
                                                        depth  0.015
                                                    }
                                                    SoTransform { translation 0.0575 0 0 }
                                                    SoBaseColor { rgb 1.0 0.0 0.0 }
                                                    SoCube {
                                                        width = SoCalculator {
                                                            a = USE BATTERY_POWER.width
                                                            expression "oa = 0.115 - a"
                                                        }.oa
                                                        height 0.015
                                                        depth  0.015
                                                    }
                                                }
                                                # battery power text value
                                                Separator {
                                                    SoTransform { 
                                                        translation 0 0.02 -0.19
                                                        scaleFactor 0.008 0.008 0.008
                                                    }
                                                    Material { diffuseColor 1 1 1 }
                                                    SoText3 {
                                                        string = USE LEGOPUPPETEER.batteryPower
                                                        justification CENTER
                                                        parts ALL
                                                    }
                                                }
                                            }
                                        }
                                    }

                                    # LEGO model augmentation elements, we start indexing the augmentation parts being referred to in the construction file here from zero
                                    Separator { # No. 0
                                        Transform {
                                            scaleFactor = SoCalculator {
                                                A 1 1 1
                                                a = SoOneShot {
                                                    duration 2
                                                    trigger = SoElapsedTime{}.timeOut
                                                }.ramp
                                                expression "oA=A*(1-a)"
                                            }.oA
                                        }
                                        File { name "../apps/arpuppet/demo/arlego/mesh/infrared_ray.iv" }
                                    }
                                    Separator { # No. 1
                                        Switch {
                                            whichChild = SoTimeCounter {
                                                min 0
                                                max 1
                                                frequency 1
                                            }.output
                                            Separator {}
                                            Separator {
                                                DEF HOTWIRE_COLOR Material { diffuseColor 1 0 1 emissiveColor 1 0 1 }
                                                File { name "../apps/arpuppet/demo/arlego/mesh/wire_engine_a.iv" }
                                            }
                                        }
                                    }
                                    Separator { # No. 2
                                        Switch {
                                            whichChild = SoTimeCounter {
                                                min 0
                                                max 1
                                                frequency 1
                                            }.output
                                            Separator {}
                                            Separator {
                                                USE HOTWIRE_COLOR
                                                File { name "../apps/arpuppet/demo/arlego/mesh/wire_engine_c.iv" }
                                            }
                                        }
                                    }
                                    Separator { # No. 3
                                        Material { diffuseColor 0 0 1 emissiveColor 0 0 1 }
                                        Switch {
                                            whichChild = SoTimeCounter {
                                                min 0
                                                max 1
                                                frequency 1
                                            }.output
                                            Separator {
                                                DEF RCX_BUTTON Separator {
                                                    File { name "../apps/arpuppet/demo/arlego/mesh/start_button.iv" }
                                                }
                                                DEF ARROW_STRAIGHT Separator {
                                                    File { name "../apps/arpuppet/demo/arlego/mesh/arrow_straight.iv" }
                                                }
                                            }
                                            Separator {
                                                Separator {
                                                    Transform { translation 0 -0.0101594 0 }
                                                    USE RCX_BUTTON
                                                }
                                                Separator {
                                                    Transform { translation 0 -0.0101594 0 }
                                                    USE ARROW_STRAIGHT
                                                }
                                            }
                                        }
                                    }
                                    Separator { # No. 4
                                        Transform {
                                            scaleFactor = SoCalculator {
                                                A 1 1 1
                                                a = SoOneShot {
                                                    duration 2
                                                    trigger = USE DIRECTOR.constructionStep
                                                    flags (HOLD_FINAL | RETRIGGERABLE)
                                                }.ramp
                                                expression "oA=A*a"
                                            }.oA
                                        }
                                        File { name "../apps/arpuppet/demo/arlego/mesh/rcx_display_zoom.iv" }
                                    }
                                    Separator { # No. 5
                                        SoSwitch {
                                            whichChild = SoCalculator {
                                                a = USE LEGOPUPPETEER.alive
                                                b = USE LEGOPUPPETEER.engineA
                                                expression "oa = ((a==1) && (b==1))? 1 : 0"
                                            }.oa
                                            Separator {}
                                            Separator {
                                                Separator {
                                                    SoBaseColor { rgb 1 0 0 }
                                                    SoTransform { scaleFactor 1.05 1.05 1.05 }
                                                    Separator { USE ENGINE_A }
                                                    Separator { USE WHEEL_BACK_RIGHT_A }
                                                    Separator { USE WHEEL_BACK_RIGHT_B }
                                                }
                                                Separator {
                                                    SoTransform { translation -0.22 0 -0.04 scaleFactor 0.4 0.4 0.4 }
                                                    SoSwitch {
                                                        whichChild = USE LEGOPUPPETEER.engineDirA
                                                        DEF ARROW_ANTICLOCKWISE_ENGINE_A Separator {
                                                            RotationXYZ {
                                                                axis X
                                                                angle = ElapsedTime { 
                                                                    speed -5.0 
                                                                }.timeOut
                                                            }
                                                            DEF ARROW_CIRCULAR Separator {
                                                                Material { diffuseColor 0.1098 0.1098 0.6941 }
                                                                SoFile { name "../apps/arpuppet/demo/arlego/mesh/arrow_circular.iv" }
                                                            }
                                                        }
                                                        DEF ARROW_CLOCKWISE_ENGINE_A Separator {
                                                            RotationXYZ { axis Y angle 3.14 }
                                                            RotationXYZ {
                                                                axis X 
                                                                angle = ElapsedTime { 
                                                                    speed -5.0 
                                                                }.timeOut
                                                            }
                                                            USE ARROW_CIRCULAR
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    Separator { # No. 6
                                        SoSwitch {
                                            whichChild = SoCalculator {
                                                a = USE LEGOPUPPETEER.alive
                                                b = USE LEGOPUPPETEER.engineC
                                                expression "oa = ((a==1) && (b==1)) ? 1 : 0"
                                            }.oa
                                            Separator {}
                                            Separator {
                                                Separator {
                                                    SoBaseColor { rgb 1 0 0 }
                                                    SoTransform { scaleFactor 1.05 1.05 1.05 }
                                                    Separator { USE ENGINE_C }
                                                    Separator { USE WHEEL_BACK_LEFT_A }
                                                    Separator { USE WHEEL_BACK_LEFT_B }
                                                }
                                                Separator {
                                                    SoTransform { translation 0.22 0 -0.04 scaleFactor 0.4 0.4 0.4 }
                                                    SoSwitch {
                                                        whichChild = USE LEGOPUPPETEER.engineDirC
                                                        DEF ARROW_ANTICLOCKWISE_ENGINE_C Separator {
                                                            RotationXYZ {
                                                                axis X
                                                                angle = ElapsedTime { 
                                                                    speed -5.0 
                                                                }.timeOut
                                                            }
                                                            USE ARROW_CIRCULAR
                                                        }
                                                        DEF ARROW_CLOCKWISE_ENGINE_C Separator {
                                                            RotationXYZ { axis Y angle 3.14 }
                                                            RotationXYZ {
                                                                axis X 
                                                                angle = ElapsedTime { 
                                                                    speed -5.0 
                                                                }.timeOut
                                                            }
                                                            USE ARROW_CIRCULAR
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    Separator { # No. 7
                                        Switch {
                                            whichChild = SoTimeCounter {
                                                min 0
                                                max 1
                                                frequency 1
                                            }.output
                                            Separator {}
                                            Separator {
                                                USE HOTWIRE_COLOR
                                                File { name "../apps/arpuppet/demo/arlego/mesh/wire_pushsensor.iv" }
                                            }
                                        }
                                    }
                                    Separator { # No. 8
                                        Material { diffuseColor 0 0 1 emissiveColor 0 0 1 }
                                        Switch {
                                            whichChild = SoTimeCounter {
                                                min 0
                                                max 1
                                                frequency 1
                                            }.output
                                            DEF ARROW_PUSH Separator {
                                                Transform {
                                                    translation 0.171549 0.0228444 0.107719
                                                    rotation 1 0 0 1.57079
                                                }
                                                USE ARROW_STRAIGHT
                                            }
                                            Separator {
                                                Transform { translation 0 0 -0.0101594 }
                                                USE ARROW_PUSH
                                            }
                                        }
                                        Separator {
                                            Material { diffuseColor 1 0 0 }
                                            Transform { translation 0.25 0.15 0.17 scaleFactor 0.005 0.005 0.005 }
                                            SoText3 {
                                                parts ALL
                                                justification CENTER
                                                string = SoSelectOne {
                                                    type SoMFString
                                                    input [ "OFF", "ON" ]
                                                    index = USE LEGOPUPPETEER.sensor1
                                                }.output
                                            }
                                        }
                                    }
                                    Separator { # No. 9
                                        Switch {
                                            whichChild = SoTimeCounter {
                                                min 0
                                                max 1
                                                frequency 1
                                            }.output
                                            Separator {}
                                            Separator {
                                                USE HOTWIRE_COLOR
                                                File { name "../apps/arpuppet/demo/arlego/mesh/wire_lightsensor.iv" }
                                            }
                                        }
                                    }
                                    Separator { # No. 10
                                        Switch {
                                            whichChild = SoTimeCounter {
                                                min 0
                                                max 1
                                                frequency 1
                                            }.output
                                            Separator {
                                                Transform { translation -0.0101594 0 0 }
                                                DEF ARROW_SLIDE Separator {
                                                    Separator {
                                                        Material { diffuseColor 0.08 0.08 0.08 emissiveColor 0.08 0.08 0.08 }
                                                        Transform {
                                                            translation -0.476352 0.0030027 0.449801
                                                            rotation 0 1 0 1.57079
                                                        }
                                                        Transform {
                                                            translation 0.171549 0.0228444 0.107719
                                                            rotation 1 0 0  1.57079
                                                        } 
                                                        USE ARROW_STRAIGHT
                                                    }
                                                    Separator {
                                                        Material { diffuseColor 1 1 1 emissiveColor 1 1 1 }
                                                        Transform {
                                                            translation 0.0190807 0.00300263 -0.010022
                                                            rotation 0 -1 0 1.57079
                                                        }
                                                        Transform {
                                                            translation 0.171549 0.0228444 0.107719
                                                            rotation 1 0 0 1.57079
                                                        }
                                                        USE ARROW_STRAIGHT
                                                    }
                                                }
                                            }
                                            Separator {
                                                Transform { translation 0.0101594 0 0 }
                                                USE ARROW_SLIDE
                                            }
                                        }
                                        Separator {
                                            Transform { translation -0.25 0.15 0.17 }
                                            Separator {
                                                Transform { translation 0 0 -0.005 }
                                                Material { 
                                                    diffuseColor = SoCalculator {
                                                        a = USE LEGOPUPPETEER.sensor3
                                                        expression [
                                                            "ta = a/100",
                                                            "oA[0] = ta",
                                                            "oA[1] = ta",
                                                            "oA[2] = ta"
                                                        ]
                                                    }.oA
                                                }
                                                Cube { width 0.1 height 0.1 depth 0.001 }
                                            }
                                            Separator {
                                                Transform { scaleFactor 0.005 0.005 0.005 }
                                                Material { diffuseColor 1 0 0 }
                                                SoText3 {
                                                    parts ALL
                                                    justification CENTER
                                                    string = USE LEGOPUPPETEER.sensor3
                                                }
                                            }
                                        }
                                    }

                                } # end of robot augmentation Separator
                            } # end of SoLegoPuppeteer
                            
                            DEF LEGOMAXL_PUPPETEER Character {
                                controlMode [ (STATION | DRAG), (STATION | DRAG), EXTERNAL ]
                                station 1
                                scaleSet = SoInfo { string "0.8 0.8 0.8" }.string
                                showPuppeteer = USE DIRECTOR.usePresenter
                                puppets SoDragKit {
                                    content Separator {
                                        SoMultiSwitch {
                                            DEF LEGOMAXL_PUPPET SoCal3DPuppet {
                                                pathName "../apps/arpuppet/characters/cal3dpuppet/data"
                                                fileName "legomaxl.cfg"
                                                delayIn 0.4
                                                delayOut 0.4
                                            } # end of SoCal3DPuppet
                                        }
                                    }
                                }
                                animationPrefix "legomaxl_"
                            } # end of Character
                        }
                    } # end of Choreographer

                    # HUD
                    SoSwitch {
                        whichChild = SoOnOff {
                            toggle = USE KEY_H.toggled
                        }.isOn
                        Separator {}
                        Separator {
                            DEF ORTHOGRAPHICCAMERA SoOrthographicCamera {
                                height 1.0
                                aspectRatio 1.0
                                nearDistance 0.5
                                viewportMapping LEAVE_ALONE
                            }
                            Separator {
                                Transform { translation -0.4 0.42 -0.01 scaleFactor 1.0 1.2 1.0 }
                                Material { diffuseColor 1 1 1 transparency 0.5 }
                                Cube { width 1 depth 0 height 0.14 }
                            }
                            Separator {
                                Transform { translation -0.48 0.44 0 scaleFactor 0.01 0.012 0.01 }
                                #Material { diffuseColor 0 0 0.5 }
                                Material { diffuseColor 0 0 0.5 }
                                SoFont { name "Arial : Bold" size 4 }
                                SoAsciiText {
                                    justification LEFT
                                    string = SoStringCalculator {
                                        a ">"
                                        b = USE DIRECTOR.explanation
                                        expression "oa = a + b"
                                    }.oa
                                }
                                Material { diffuseColor 1 1 0 transparency 0.4 }
                                SoAsciiText {
                                    justification LEFT
                                    string ">"
                                }
                            }
                            Separator {
                                SoSwitch {
                                    whichChild = SoOnOff {
                                        toggle = USE KEY_I.toggled
                                    }.isOn
                                    Separator {}
                                    Separator {
                                        Transform { translation 0.48 0.44 0 scaleFactor 0.01 0.012 0.01 }
                                        Material { diffuseColor 1 1 1 transparency 0.4 }
                                        SoFont { name "Arial : Bold" size 4 }
                                        SoAsciiText {
                                            justification RIGHT
                                            string = SoStringCalculator {
                                                a = DEF CALC SoCalculator {
                                                    a = USE DIRECTOR.constructionStep
                                                    b = USE DIRECTOR.maxConstructionStepIndex
                                                    expression [ "oa = a + 1", "ob = b + 1" ]
                                                }.oa
                                                b "/"
                                                c = USE CALC.ob
                                                expression "oa = a + b + c"
                                            }.oa
                                        }
                                    }
                                }
                            }
                        }
                    }

                    # TTS engine
                    DEF SPEECH SoSpeechOutput {
                        voiceName "Mike" # Microsoft Mike for default Microsoft voice, Mike for ATT's voice
                        text = SoGate {
                            type SoMFString
                            input = USE DIRECTOR.explanation
                            enable = DEF USE_TTS SoOnOff { toggle = USE KEY_S.toggled }.isOn
                        }.output
                        restartOnStart TRUE
                        startOnSetText TRUE
                        start = SoGate {
                            type SoMFBool
                            input TRUE
                            enable = USE USE_TTS.isOn
                        }.output
                        stop = SoGate {
                            type SoMFBool
                            input TRUE
                            enable = USE USE_TTS.isOff
                        }.output
                    }

                } # end of clientVolume

            } # end of windowKit

        } # end of windowGroup

    } # end of contextKit

} # end of applicationKit
