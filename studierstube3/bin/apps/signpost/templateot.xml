<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- edited with XMLSPY v2004 rel. 2 U (http://www.xmlspy.com) by Ponder (Vienna University of Technology) -->
<!DOCTYPE OpenTracker SYSTEM "../../workspace/opentracker.dtd">
<OpenTracker>
  <!--
  Standard tracking config for mobile setup from 01-04-2003
  includes :
  4mm FireFly Extended Camera
  TouchPad with tracked point
  IntertiaCube2 for head rotation
  An calibOffsetCam for calibrating virtual camera offsets
-->
  <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <!-- OpenTracker configuration -->
  <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <configuration>
    <ARToolKitConfig camera-parameter="config/firefly_4mm.dat" framerate="9" pattern-dir="patt" treshhold="100" videomode="WDM_CAP,videoWidth=640,videoHeight=480"/>
    <ConsoleConfig display="off" headerline="Mobile Setup" interval="20"/>
    <InterSenseConfig>
      <ISTracker comport="1" id="InertiaCube"/>
    </InterSenseConfig>
  </configuration>
  <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <!-- Local ARToolkit Makers -->
  <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <EventTransform DEF="lambda" rotation="1 0 0 0" scale="0.001 0.001 0.001">
    <ARToolKitSource center="0 0" size="80" tag-file="lambda.tag"/>
  </EventTransform>
  <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <!-- Camera Tracking -->
  <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <!-- All local events merged (for inertia tracking resets) -->
  <!-- Intertrax oriented to typical OpenInventor camera space -->
  <EventVirtualOrientationTransform DEF="orientation" rotation="0 -1 0 1 0 0 0 0 1" rotationtype="matrix">
    <EventOrientationTransform rotation="0 1 0 -1 0 0 0 0 1" rotationtype="matrix">
      <InterSenseSource id="InertiaCube"/>
    </EventOrientationTransform>
  </EventVirtualOrientationTransform>
  <!-- Offsets the readings from inertia tracker by it's inverse everytime at least ONE marker is visible. we use allLocal to provide that -->
  <EventDynamicTransform DEF="head_offset">
    <TransformBase>
      <EventInvertTransform DEF="inverse">
        <TimeGate timeframe="100">
          <Gate>
            <Ref USE="RawTracking"/>
          </Gate>
          <Ref USE="orientation"/>
        </TimeGate>
      </EventInvertTransform>
    </TransformBase>
    <Ref USE="orientation"/>
  </EventDynamicTransform>
  <!-- output to camera station -->
  <!-- output to camera station -->
  <Merge DEF="Head">
    <MergePosition>
      <Filter weight="0.25 0.25 0.25 0.25">
        <EventQueue length="4">
          <Ref USE="RawTracking"/>
        </EventQueue>
      </Filter>
    </MergePosition>
    <MergeOrientation>
      <EventDynamicTransform baseevent="false">
        <TransformBase>
          <ConfidenceFilter treshhold="0.5" type="high">
            <Ref USE="RawTracking"/>
          </ConfidenceFilter>
        </TransformBase>
        <Ref USE="head_offset"/>
      </EventDynamicTransform>
    </MergeOrientation>
  </Merge>
  <StbSink DEF="camera" station="2">
    <EventVirtualTransform DEF="calibOffsetCam" rotation="0 0 0 1" translation="0 0 0">
      <Ref USE="Head"/>
    </EventVirtualTransform>
  </StbSink>
  <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <!-- Devices -->
  <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <!-- PIP -->
  <StbSink DEF="pip" station="1">
    <EventTransform translation="0 0 0">
      <EventDynamicTransform baseevent="false">
        <TransformBase>
          <Ref USE="Head"/>
        </TransformBase>
        <Ref USE="lambda"/>
      </EventDynamicTransform>
    </EventTransform>
  </StbSink>
  <StbSink station="6">
    <Ref USE="lambda"/>
  </StbSink>
  <!-- PIP pointer -->
  <StbSink event="on" station="3">
    <Merge>
      <MergeDefault>
        <EventDynamicTransform baseevent="true">
          <TransformBase>
            <Ref USE="pip"/>
          </TransformBase>
          <EventTransform rotation="0 1 0 0" scale="-0.1 -0.1 0" translation="-0.05 0.05 0.001" DEF="pointer">
            <StbMouseSource DEF="TouchPad" mode="relative"/>
          </EventTransform>
        </EventDynamicTransform>
      </MergeDefault>
      <MergeButton>
        <ButtonOp DEF="Buttons" op="OR">
          <Arg1>
            <Ref USE="TouchPad"/>
          </Arg1>
          <Arg2>
            <StbKeyboardSource number="0"/>
          </Arg2>
        </ButtonOp>
      </MergeButton>
    </Merge>
  </StbSink>
  <StbSink station="7">
    <Ref USE="pointer"/>
  </StbSink>
  <!-- 
    use this to add a parallel button 
  <ButtonFilter buttonmap="23016745">
    <ParButtonSource dev="0x378"/>
  </ButtonFilter>
  -->
  <!-- raypicker output, needs to be corrected for raypicking axis ! -->
  <StbSink station="5" event="on">
    <Merge>
      <MergeDefault>
        <EventVirtualOrientationTransform rotation="1 0 0 -1.57" rotationtype="axisangle">
          <Ref USE="camera"/>
        </EventVirtualOrientationTransform>
      </MergeDefault>
      <MergeButton>
        <Ref USE="Buttons"/>
      </MergeButton>
    </Merge>
  </StbSink>
  <!-- debug output of every single marker, used to visualize the recognized markers -->
  <StbSink station="20">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern0"/>
    </EventTransform>
  </StbSink>
  <StbSink station="21">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern1"/>
    </EventTransform>
  </StbSink>
  <StbSink station="22">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern2"/>
    </EventTransform>
  </StbSink>
  <StbSink station="23">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern3"/>
    </EventTransform>
  </StbSink>
  <StbSink station="24">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern4"/>
    </EventTransform>
  </StbSink>
  <StbSink station="25">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern5"/>
    </EventTransform>
  </StbSink>
  <StbSink station="26">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern6"/>
    </EventTransform>
  </StbSink>
  <StbSink station="27">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern7"/>
    </EventTransform>
  </StbSink>
  <StbSink station="28">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern8"/>
    </EventTransform>
  </StbSink>
  <StbSink station="29">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern9"/>
    </EventTransform>
  </StbSink>
  <StbSink station="30">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern10"/>
    </EventTransform>
  </StbSink>
  <StbSink station="31">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern11"/>
    </EventTransform>
  </StbSink>
  <StbSink station="32">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern12"/>
    </EventTransform>
  </StbSink>
  <StbSink station="33">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern13"/>
    </EventTransform>
  </StbSink>
  <StbSink station="34">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern14"/>
    </EventTransform>
  </StbSink>
  <StbSink station="35">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern15"/>
    </EventTransform>
  </StbSink>
  <StbSink station="36">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern16"/>
    </EventTransform>
  </StbSink>
  <StbSink station="37">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern17"/>
    </EventTransform>
  </StbSink>
  <StbSink station="38">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern18"/>
    </EventTransform>
  </StbSink>
  <StbSink station="39">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern19"/>
    </EventTransform>
  </StbSink>
  <StbSink station="40">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern20"/>
    </EventTransform>
  </StbSink>
  <StbSink station="41">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern21"/>
    </EventTransform>
  </StbSink>
  <StbSink station="42">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern22"/>
    </EventTransform>
  </StbSink>
  <StbSink station="43">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern23"/>
    </EventTransform>
  </StbSink>
  <StbSink station="44">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern24"/>
    </EventTransform>
  </StbSink>
  <StbSink station="45">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern25"/>
    </EventTransform>
  </StbSink>
  <StbSink station="46">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern26"/>
    </EventTransform>
  </StbSink>
  <StbSink station="47">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern27"/>
    </EventTransform>
  </StbSink>
  <StbSink station="48">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern28"/>
    </EventTransform>
  </StbSink>
  <StbSink station="49">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern29"/>
    </EventTransform>
  </StbSink>
  <StbSink station="50">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern30"/>
    </EventTransform>
  </StbSink>
  <StbSink station="51">
    <EventTransform rotation="1 0 0 0" scale="0.001 0.001 0.001">
      <Ref USE="MARKER_pattern31"/>
    </EventTransform>
  </StbSink>
  <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <!-- debug stuff -->
  <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <ConsoleSink comment="Inertial Tracker">
    <Ref USE="orientation"/>
  </ConsoleSink>
  <ConsoleSink comment="All Local Markers">
    <Ref USE="AllMarkers"/>
  </ConsoleSink>
  <ConsoleSink comment="Head Offset">
    <Ref USE="head_offset"/>
  </ConsoleSink>
  <ConsoleSink comment="Head" active="off">
    <Ref USE="Head"/>
  </ConsoleSink>
  <ConsoleSink comment="Inverse" active="on">
    <Ref USE="inverse"/>
  </ConsoleSink>
</OpenTracker>
